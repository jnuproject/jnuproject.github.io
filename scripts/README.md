# 지오코딩 스크립트 사용 가이드

이 스크립트는 `affiliates.json` 파일의 주소를 Google Geocoding API를 사용하여 정확한 위도/경도 좌표로 변환합니다.

## 사전 준비

### 1. Google Cloud API 키 받기

1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 프로젝트 생성 또는 기존 프로젝트 선택
3. 좌측 메뉴에서 **"API 및 서비스"** > **"라이브러리"** 클릭
4. **"Geocoding API"** 검색 후 **"사용 설정"** 클릭
5. 좌측 메뉴에서 **"사용자 인증 정보"** 클릭
6. **"사용자 인증 정보 만들기"** > **"API 키"** 선택
7. 생성된 API 키 복사

### 2. 요금 안내

- Google Geocoding API는 **월 $200 무료 크레딧** 제공
- 지오코딩: **1,000건당 $5**
- 110개 주소 변환 비용: **약 $0.55** (무료 범위 내)
- 무료 크레딧 초과 시 과금되므로 **결제 정보 설정** 필요

## 사용 방법

### 1. API 키 설정

`scripts/geocode-addresses.js` 파일을 열어서 API 키를 입력하세요:

```javascript
const GOOGLE_API_KEY = 'YOUR_API_KEY_HERE';  // ← 여기에 받은 API 키 입력
```

### 2. 스크립트 실행

프로젝트 루트 디렉토리에서 다음 명령어를 실행하세요:

```bash
node scripts/geocode-addresses.js
```

### 3. 실행 과정

스크립트는 다음 작업을 수행합니다:

1. ✅ `data/affiliates.json` 파일 로드
2. 💾 백업 파일 생성 (`data/affiliates.backup.json`)
3. 🔍 각 주소를 Google API로 지오코딩
4. ✅ 좌표 업데이트
5. 💾 업데이트된 데이터 저장

### 4. 예상 소요 시간

- 110개 업체 × 0.2초 = **약 22초**
- API 호출 제한을 피하기 위해 각 요청 사이에 200ms 대기

## 실행 결과 예시

```
🗺️  지오코딩 스크립트 시작...

✅ 110개의 제휴 업체 데이터 로드 완료

💾 백업 파일 생성: /Users/goyehun/myApp/data/affiliates.backup.json

🚀 지오코딩 시작...

[1/110] 🔍 리릭 - 제주 제주시 아란9길 25 1층 리릭
[1/110] ✅ 좌표: 33.4621, 126.5402

[2/110] 🔍 마왕족발 제주아라점 - 제주 제주시 아란7길 3-2
[2/110] ✅ 좌표: 33.4618, 126.5395

...

💾 업데이트된 데이터 저장 완료!

==================================================
📊 지오코딩 결과 요약
==================================================
✅ 성공: 105개
❌ 실패: 2개
⏭️  건너뜀: 3개
📁 총: 110개
==================================================

✨ 완료!
```

## 주의사항

### ⚠️ 백업
- 스크립트는 자동으로 백업 파일을 생성하지만, 실행 전에 수동 백업도 권장합니다
- 백업 파일: `data/affiliates.backup.json`

### ⚠️ API 키 보안
- API 키는 **절대로 GitHub에 커밋하지 마세요**
- 실수로 커밋한 경우 즉시 Google Cloud Console에서 키를 삭제하고 재발급받으세요

### ⚠️ 요금 확인
- [Google Cloud Console 결제 페이지](https://console.cloud.google.com/billing)에서 사용량을 확인할 수 있습니다
- 무료 크레딧 초과 시 과금되므로 주의하세요

## 문제 해결

### API 키 오류
```
❌ Google API 키를 설정해주세요!
```
→ `geocode-addresses.js` 파일에서 `GOOGLE_API_KEY` 값을 확인하세요

### 지오코딩 실패
```
❌ 지오코딩 실패 (주소): ZERO_RESULTS
```
→ 주소가 정확하지 않거나 Google이 인식할 수 없는 형식입니다
→ 해당 업체는 기존 좌표를 유지합니다

### API 할당량 초과
```
❌ API 호출 오류: OVER_QUERY_LIMIT
```
→ API 호출 제한에 도달했습니다
→ 잠시 기다렸다가 다시 실행하세요

## 백업 복원

문제가 발생한 경우 백업 파일로 복원할 수 있습니다:

```bash
cp data/affiliates.backup.json data/affiliates.json
```

## 추가 설정

### API 호출 간격 조정

네트워크가 느리거나 API 제한에 자주 걸리는 경우, 딜레이를 늘릴 수 있습니다:

```javascript
const DELAY_MS = 500;  // 200 → 500으로 변경
```

## 도움말

문제가 지속되면 다음을 확인하세요:

1. Google Cloud Console에서 Geocoding API가 활성화되어 있는지
2. API 키가 올바르게 입력되었는지
3. 결제 정보가 등록되어 있는지 (무료 크레딧 사용 시에도 필요)
4. 네트워크 연결이 정상인지
