const fs = require('fs');
const path = require('path');

// 카테고리 정규화
function normalizeCategory(cat) {
  const map = {
    '문화생활/복지': '문화생활・복지',
    '카페/베이커리': '카페・베이커리',
    '미용/뷰티/패션': '미용・뷰티・패션',
    '레저/스포츠': '레저・스포츠',
    '음식점점': '음식점',
    '음식': '음식점',
    '시청청': '음식점',
    '(실시간 제휴)': '음식점',
    '카페': '카페・베이커리'
  };
  return map[cat] || cat;
}

// 기존 데이터 로드
const affiliatesPath = path.join(__dirname, '../data/affiliates.json');
const existing = JSON.parse(fs.readFileSync(affiliatesPath, 'utf8'));
console.log(`기존 업체: ${existing.length}개`);

// 원본 데이터 (탭으로 구분)
const rawData = `문화생활/복지	전자랜드 제주점	삼도	제주 제주시 서사로 32	생활가전 5~10% 할인
음식점	명륜진사갈비 아라점	아라일동	제주 제주시 아란7길 6 1층	제대학생 확인시 3,000원 할인
음식점	고기앞에 모두 평등하다	이도이동	제주 제주시 광양11길 18-1	계란후리이, 매실, 수제식혜, 공기밥 제공/ 소주 4,000원
의료	나우메디의원	아라	제주 제주시 연북로 511 에이플렉스 3층	뷰티시술 정가의 10%(이벤트가 일시, 이벤트가의  5%추가할인)/ 가다실( 자궁경부암 예방접종) 1회접종시 2만원 할인, 3회 접종시 3만원 할인
음식점	오라방 솥뚜껑	도남	제주 제주시 도남로 48-1	음료수 서비스 2개
음식점	한양고깃집 제주아라점	도남	제주 제주시 도남로 199 1층	사이드메뉴(주류 포함) 1개
문화생활/복지	달토록도자공방	도남동	제주 제주시 도남로7길 44 4층	2인 이상 방문 시 20% 할인
문화생활/복지	그램 필라테스 노형점	노형	제주 제주시 노형로 367 3F	그룹수업 8회 +1회 16회+2회 24회 +3 회 48회 +4회
문화생활/복지	아하 필라테스 & 발레	삼화	제주 제주시 건주로 43 4층	그룹수업 8회 +1회 16회+2회 24회 +3 회 48회 +4회
음식점	친정집	화북	제주 제주시 일주동로 260	20% 할인
음식점	아구듬뿍&알곤마니 구제주점	이도이동	제주 제주시 정든로5길 24	음료 1.25L 무료 제공
미용/뷰티/패션	플루즈(pelouse)	이도이동	제주 제주시 서광로32길 42 1층	카드 결제시 5% 현금으로 결제시 10% 할인
미용/뷰티/패션	네일해나	이도이동	제주 제주시 신성로13길 25-1 1층	3천원 할인 + 네이버 포토리뷰 5천원 할인 ( 중복적용가능, 케어제외 및 원컬러 시술 시 가능)
카페/베이커리	트위스터 윗	이도이동	제주 제주시 고산동산1길 11 1층	매장 방문시 10% DC , 5개구매 시 1개 서비스
카페/베이커리	좋수다	일도이동	제주 제주시 고마로11길 45 1층	20% 할인 + 리뷰이벤트 시 미니 요거트볼
문화생활/복지	파랑책방	아라일동	제주 제주시 인다5길 11-7 102호 파랑책방	책 구매 시 파랑로고 양말 증정
음식점	별미돈	아라일동	제주 제주시 인다13길 59	2인분 이상 주문시 음료 1개 서비스, 3인분 이상 주문시 계란찜 서비스
문화생활/복지	그램 필라테스 아라점	아라동	제주 제주시 아봉로 56 2F	그룹수업 8회 +1회 16회+2회 24회 +3 회 48회 +4회
카페	뭉실몽실	이도이동	제주 제주시 구남동6길 15 1층	음료 20% 할인 또는 휘낭시에 1개 제공
교육	르하임 스터디카페 아라점	아라동	제주 제주시 중앙로 558 2층	100시간 구매시+50시간/ 4주기간 구매시+7일
문화생활/복지	몸냥공작소	애월	제주 제주시 애월읍 유수암리 2475-1	와펜 체험시 와펜 1개 무료 증정
카페	청연 디저트	이도이동	제주 제주시 도남로 189 1층 청연디저트카페	음료 5% 할인 (네이버리뷰작성시 10% 할인적용)
문화생활/복지	WISE 퍼스널컬러	이도이동	제주 제주시 남광로4길 15 1층 WISE퍼스널컬러	20% 할인
미용/뷰티/패션	크롬웰 안경제주점	시청	제주 제주시 중앙로 206 1층 크롬웰안경	추가할인 15%, 콘텍트렌즈 제주 최저가, 원데이렌즈30p 15,000원
문화생활/복지	고수의 운전면허(HKQ)	이도일동	제주 제주시 서광로 291 1층 고수의 운전면허	제주대학교 재학생 이용권 10% 할인
미용/뷰티/패션	114 칼라 스튜디오	연동	제주 제주시 과원북2길 50	원본 파일 전송, 추가 인화 2장 이상
카페	모찌롱	삼도이동	제주 제주시 관덕로6길 12 모찌롱	디저트류 10% 할인
미용/뷰티/패션	소모소빈티지샵	삼도이동	제주 제주시 중앙로2길 21 1층	제주대학교 학생 전제품 5% 할인
레저/스포츠	제주라인스쿠터	삼도이동	제주 제주시 용마로 28 1층 제주라인스쿠터	부가용품 제공 및 연료비 5000원 지원
미용/뷰티/패션	베베뷰티	일도일동	제주 제주시 중앙로7길 19 3층	케어제거x, 젤시술 시 15%
카페	에브리블룸	일도이동	제주 제주시 동문로 62 1층 에브리블룸	꽃다발 5만원이상 10%할인
음식점	101동 파스타	이도이동	제주 제주시 박성내서길 12-7 1층	10% 할인
카페/베이커리	제로정류장	서귀포	제주 서귀포시 중앙로 50 1층	10% 할인
미용/뷰티/패션	재발견 상점	서귀포	제주 서귀포시 태평로371번길 32 이중섭 거리	5% 할인
음식점	제주곶 서귀포 해물라면	서귀포포	제주 서귀포시 칠십리로214번길 36 제주곶 서귀포 해물라면	튀김 & 음료 제공
문화생활/복지	제주 다차공간	서귀포	제주 서귀포시 성산읍 남산봉로 83-103 제주다차공간	바베큐 & 불멍 제공
레저/스포츠	태성 풋살장	서귀포	제주 서귀포시 남원읍 하례망장포로26번길 61-4	10% 할인
음식점	사계바다	서귀포	제주 서귀포시 안덕면 형제해안로 26 1층 사계바다	협약서 싸인은 받았는데 제휴 내용은 전화로 협의
문화생활/복지	책방왓	서귀포	제주 서귀포시 안덕면 화순로56번길 28	도서구입시 15% 할인, 기본공간이용 3시간 무료
문화생활/복지	중문승마공원	서귀포	제주 서귀포시 이어도로 244 제주하이랜드	해변올레길 코스 2인 체험시 당근바구니 서비스
음식점	윤성식당	서귀포	제주 서귀포시 대정읍 일주서로3000번길 139 1F	방문시 음료수 무료 증정
음식점	와랑와랑한식뷔페	서귀포	제주 서귀포시 대정읍 추사로 93-11 1층	음료제공(1인 1음료)
카페	라스트플라츠커피	이도이동	제주 제주시 구남로8길 26 1층	모든음료 10% 할인
레저/스포츠	볼링앤와인갤러리	아라일동	제주 제주시 구산로 4 1층	볼링장 예약 후 현금 결제 시 체험비용 20% 할인
레저/스포츠	락온MMA 팀락온 아라관	아라일동	제주 제주시 중앙로 536 2층	3개월 등록시 도복 무료 + 레쉬가드 무료 (재고 소진 전까지) + 머그컵 무료(재고 소진 전 까지) + 친구와 함께 등록 시 각 2주 무료 연장
음식점	리릭	아라일동	제주 제주시 아란9길 25 1층 리릭	2인당 음료 1개 제공
카페	베이커리우빵	이도이동	제주 제주시 동고산로 34 1층	10% 할인
미용/뷰티/패션	라라라	이도이동	제주 제주시 신성로13길 16 1층상가 여성의류매장 라라라	카드 5%, 현금 10% 할인
미용/뷰티/패션	뢰임안경	이도이동	제주 제주시 중앙로 350 뢰임안경	20% 할인
카페	제주트립티산지	탑���	제주 제주시 관덕로17길 29 산지천갤러리 1층	음료 15% 할인
카페	커피스트릿16	용담이동	제주 제주시 용두암길 16 1층	전 메뉴 10% 할인
음식점	마왕족발 아라점	아라일동	제주 제주시 아란7길 3-2	새우볶음밥, 음료수 1.25L 택 1 서비스
문화생활/복지	제주자연인글램핑	아라일동	제주 제주시 아란서길 110 B동 별관	제주대 학생증 지참시 10% 할인`;

// 파싱
const lines = rawData.trim().split('\n');
console.log(`새 데이터: ${lines.length}개`);

const maxId = Math.max(...existing.map(i => parseInt(i.id)));

const newItems = lines.map((line, idx) => {
  const parts = line.split('\t');
  return {
    id: String(maxId + idx + 1),
    name: parts[1].trim(),
    category: normalizeCategory(parts[0].trim()),
    region: parts[2] ? parts[2].trim() : '',
    address: parts[3] ? parts[3].trim() : '',
    description: parts[4] ? parts[4].trim() : '',
    image: 'https://placehold.co/200x200',
    latitude: 33.4996,
    longitude: 126.5312
  };
});

const all = [...existing, ...newItems];
console.log(`총: ${all.length}개`);

// 저장
const json = JSON.stringify(all, null, 2);
fs.writeFileSync(affiliatesPath, json);
fs.writeFileSync(path.join(__dirname, '../docs/data/affiliates.json'), json);
console.log('✅ 완료!');
